<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shake Heart</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#0f1220;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  font-family:system-ui;
}
#stage{
  width:95vmin;
  height:95vmin;
}
canvas{width:100%;height:100%}
</style>
</head>
<body>

<div id="stage"></div>

<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>

<script>
const {Engine,Render,Runner,Bodies,Composite,Body,Events} = Matter;

const stage = document.getElementById("stage");
const engine = Engine.create();
engine.gravity.y = 1.1;

const w = stage.clientWidth;
const h = stage.clientHeight;

const render = Render.create({
  element: stage,
  engine,
  options:{
    width:w,
    height:h,
    wireframes:false,
    background:"transparent"
  }
});

Render.run(render);
Runner.run(Runner.create(),engine);

// ‚ù§Ô∏è —Å—Ç—ñ–Ω–∫–∏ —Å–µ—Ä—Ü—è
function heartPoints(cx,cy,scale,n=140){
  const pts=[];
  for(let i=0;i<n;i++){
    const t=(i/n)*Math.PI*2;
    const x=16*Math.pow(Math.sin(t),3);
    const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
    pts.push({x:cx+x*scale,y:cy-y*scale});
  }
  return pts;
}

const pts=heartPoints(w/2,h/2,Math.min(w,h)*0.022);

for(let i=0;i<pts.length;i++){
  const a=pts[i];
  const b=pts[(i+1)%pts.length];
  const dx=b.x-a.x;
  const dy=b.y-a.y;
  const len=Math.hypot(dx,dy);
  const angle=Math.atan2(dy,dx);

  const wall=Bodies.rectangle(
    (a.x+b.x)/2,
    (a.y+b.y)/2,
    len+20,
    20,
    {isStatic:true,angle}
  );

  Composite.add(engine.world,wall);
}

// ‚ù§Ô∏è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Å–µ—Ä–¥–µ—á–æ–∫
const hearts=[];

function spawn(){
  const r=12+Math.random()*6;
  const body=Bodies.circle(w/2+(Math.random()*30-15),h*0.25,r,{
    restitution:0.2,
    friction:0.6,
    density:0.002,
    render:{visible:false}
  });

  Body.setVelocity(body,{x:(Math.random()-0.5)*4,y:0});
  Composite.add(engine.world,body);
  hearts.push({body,r});

  if(hearts.length>250){
    Composite.remove(engine.world,hearts.shift().body);
  }
}

// –∫–∞—Å—Ç–æ–º–Ω–∏–π —Ä–µ–Ω–¥–µ—Ä ‚ù§Ô∏è
Events.on(render,"afterRender",()=>{
  const ctx=render.context;
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  for(const hrt of hearts){
    const p=hrt.body.position;
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(hrt.body.angle);
    ctx.font=hrt.r*2+"px system-ui, Apple Color Emoji";
    ctx.fillText("‚ù§Ô∏è",0,0);
    ctx.restore();
  }
});

// üì± shake detection
let lastShake=0;

function motion(e){
  const acc=e.accelerationIncludingGravity;
  if(!acc)return;

  const mag=Math.sqrt(
    (acc.x||0)**2+
    (acc.y||0)**2+
    (acc.z||0)**2
  );

  const threshold=16; // Android –Ω–æ—Ä–º
  const now=Date.now();

  if(mag>threshold && now-lastShake>350){
    lastShake=now;
    for(let i=0;i<10;i++)spawn();
  }
}

// –∞–∫—Ç–∏–≤—É—î–º–æ –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ —Ç–∞–ø—É
window.addEventListener("pointerdown",()=>{
  window.addEventListener("devicemotion",motion,{passive:true});
},{once:true});

// –ü–ö —Ç–µ—Å—Ç
window.addEventListener("keydown",e=>{
  if(e.code==="Space"){
    for(let i=0;i<10;i++)spawn();
  }
});
</script>

</body>
</html>
